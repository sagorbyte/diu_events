# Firebase Cloud Messaging (FCM) - System Architecture

## ğŸ—ï¸ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DIU Events App                          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Auth Provider â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤   FCM Service   â”‚              â”‚
â”‚  â”‚                 â”‚         â”‚                 â”‚              â”‚
â”‚  â”‚  - Login/Logout â”‚         â”‚  - Get Token    â”‚              â”‚
â”‚  â”‚  - Save Token   â”‚         â”‚  - Save Token   â”‚              â”‚
â”‚  â”‚  - Remove Token â”‚         â”‚  - Handle Msgs  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚           â”‚                           â”‚                        â”‚
â”‚           â”‚                           â”‚                        â”‚
â”‚           â–¼                           â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚         Firebase Authentication             â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚    User Notification Provider/Service       â”‚               â”‚
â”‚  â”‚                                             â”‚               â”‚
â”‚  â”‚  - sendNotificationToUser()                 â”‚               â”‚
â”‚  â”‚  - getUserNotifications()                   â”‚               â”‚
â”‚  â”‚  - markAsRead()                             â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Cloud Firestore                             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   users collection   â”‚     â”‚  user_notifications  â”‚         â”‚
â”‚  â”‚                      â”‚     â”‚     collection       â”‚         â”‚
â”‚  â”‚  - uid               â”‚     â”‚                      â”‚         â”‚
â”‚  â”‚  - name              â”‚     â”‚  - id                â”‚         â”‚
â”‚  â”‚  - email             â”‚     â”‚  - userId            â”‚         â”‚
â”‚  â”‚  - role              â”‚     â”‚  - title             â”‚         â”‚
â”‚  â”‚  - fcmToken    â—„â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤  - message           â”‚         â”‚
â”‚  â”‚  - fcmTokenUpdatedAt â”‚     â”‚  - type              â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  - eventId           â”‚         â”‚
â”‚                               â”‚  - isRead            â”‚         â”‚
â”‚                               â”‚  - createdAt         â”‚         â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ onCreate Trigger
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Firebase Cloud Functions                     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  sendPushNotificationOnCreate              â”‚               â”‚
â”‚  â”‚                                             â”‚               â”‚
â”‚  â”‚  1. Triggered when notification created    â”‚               â”‚
â”‚  â”‚  2. Fetch user's FCM token from Firestore  â”‚               â”‚
â”‚  â”‚  3. Build notification payload              â”‚               â”‚
â”‚  â”‚  4. Send via Firebase Messaging             â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                     â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  sendBulkPushNotification (HTTPS Callable) â”‚               â”‚
â”‚  â”‚                                             â”‚               â”‚
â”‚  â”‚  - Send to multiple users                  â”‚               â”‚
â”‚  â”‚  - Admin only                              â”‚               â”‚
â”‚  â”‚  - Batch processing                        â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                     â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  cleanupInvalidTokens (Scheduled)          â”‚               â”‚
â”‚  â”‚                                             â”‚               â”‚
â”‚  â”‚  - Runs every 24 hours                     â”‚               â”‚
â”‚  â”‚  - Removes tokens older than 90 days       â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Firebase Cloud Messaging (FCM)                   â”‚
â”‚                                                                 â”‚
â”‚  - Handles message delivery                                    â”‚
â”‚  - Routes to correct device                                    â”‚
â”‚  - Manages platform specifics (APNs for iOS, FCM for Android)  â”‚
â”‚  - Queues messages when device offline                         â”‚
â”‚  - Retries failed deliveries                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                         â”‚
          â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Android Device  â”‚      â”‚   iOS Device     â”‚
â”‚                  â”‚      â”‚                  â”‚
â”‚  - Notification  â”‚      â”‚  - Notification  â”‚
â”‚    Tray          â”‚      â”‚    Center        â”‚
â”‚  - System Sound  â”‚      â”‚  - Badge Count   â”‚
â”‚  - Vibration     â”‚      â”‚  - System Sound  â”‚
â”‚  - LED           â”‚      â”‚  - Banner        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Notification Flow Sequence

### 1. User Login Flow
```
User Opens App
    â”‚
    â”œâ”€â–º Enters Credentials
    â”‚
    â”œâ”€â–º Firebase Authentication
    â”‚       â”‚
    â”‚       â”œâ”€â–º Auth Success
    â”‚       â”‚
    â”‚       â””â”€â–º User Data Loaded
    â”‚
    â”œâ”€â–º FCM Service Initialized
    â”‚       â”‚
    â”‚       â”œâ”€â–º Request Notification Permission
    â”‚       â”‚
    â”‚       â””â”€â–º Get FCM Token
    â”‚
    â”œâ”€â–º Save Token to Firestore
    â”‚       â”‚
    â”‚       â””â”€â–º /users/{userId}/fcmToken
    â”‚
    â””â”€â–º User Ready to Receive Notifications âœ…
```

### 2. Sending Notification Flow
```
Admin Action (e.g., Cancel Registration)
    â”‚
    â”œâ”€â–º Event Provider Called
    â”‚
    â”œâ”€â–º UserNotificationService.sendNotificationToUser()
    â”‚       â”‚
    â”‚       â”œâ”€â–º Create UserNotification Object
    â”‚       â”‚
    â”‚       â””â”€â–º Save to Firestore
    â”‚               â”‚
    â”‚               â””â”€â–º /user_notifications/{notificationId}
    â”‚
    â”œâ”€â–º Firestore onCreate Trigger
    â”‚
    â”œâ”€â–º Cloud Function: sendPushNotificationOnCreate
    â”‚       â”‚
    â”‚       â”œâ”€â–º Read Notification Data
    â”‚       â”‚
    â”‚       â”œâ”€â–º Fetch User's FCM Token
    â”‚       â”‚       â”‚
    â”‚       â”‚       â””â”€â–º /users/{userId}/fcmToken
    â”‚       â”‚
    â”‚       â”œâ”€â–º Build Notification Payload
    â”‚       â”‚       â”‚
    â”‚       â”‚       â”œâ”€â–º Title
    â”‚       â”‚       â”œâ”€â–º Body
    â”‚       â”‚       â”œâ”€â–º Data (type, eventId, etc.)
    â”‚       â”‚       â””â”€â–º Platform Config (Android/iOS)
    â”‚       â”‚
    â”‚       â””â”€â–º Send via Firebase Messaging
    â”‚
    â”œâ”€â–º FCM Routes to Device
    â”‚
    â””â”€â–º User Receives Notification ğŸ””
            â”‚
            â”œâ”€â–º App Foreground: Show in-app
            â”‚
            â”œâ”€â–º App Background: System notification
            â”‚
            â””â”€â–º App Closed: System notification
```

### 3. User Logout Flow
```
User Clicks Logout
    â”‚
    â”œâ”€â–º Auth Provider.signOut()
    â”‚       â”‚
    â”‚       â”œâ”€â–º FCM Service.removeTokenFromFirestore()
    â”‚       â”‚       â”‚
    â”‚       â”‚       â””â”€â–º Delete /users/{userId}/fcmToken
    â”‚       â”‚
    â”‚       â”œâ”€â–º FCM Service.deleteToken()
    â”‚       â”‚       â”‚
    â”‚       â”‚       â””â”€â–º Remove Local Token
    â”‚       â”‚
    â”‚       â””â”€â–º Firebase Auth SignOut
    â”‚
    â””â”€â–º User Logged Out âœ…
        (No more notifications)
```

## ğŸ“Š Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin Panel â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Cancel Registration
       â”‚ Update Event
       â”‚ Send Announcement
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event Provider  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Calls sendNotificationToUser()
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NotificationService    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Creates Document
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firestore: user_notifications  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ onCreate Trigger
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloud Function           â”‚
â”‚ (sendPushNotification)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Read Notification
       â”‚ 2. Fetch User Token
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firestore      â”‚
â”‚ users/{userId} â”‚
â”‚ â”œâ”€ fcmToken    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Token Retrieved
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloud Function     â”‚
â”‚ Builds Payload     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Sends to FCM
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firebase Messaging â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Routes to Device
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User's Phone ğŸ“±    â”‚
â”‚ Notification Shows â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Component Responsibilities

### Client-Side (Flutter App)

| Component | Responsibility |
|-----------|---------------|
| **FCM Service** | Token management, message handling, initialization |
| **Auth Provider** | Save/remove tokens on login/logout |
| **Notification Service** | Create notification records in Firestore |
| **Notification Provider** | UI state management, mark as read |
| **Main.dart** | App initialization, background handler setup |

### Server-Side (Firebase)

| Component | Responsibility |
|-----------|---------------|
| **Cloud Functions** | Send push notifications, bulk operations, cleanup |
| **Firestore** | Store tokens, notification records |
| **FCM** | Message delivery, platform routing |
| **Security Rules** | Protect user data, validate operations |

## ğŸ” Security Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         User Authentication             â”‚
â”‚                                         â”‚
â”‚  âœ“ Firebase Auth                        â”‚
â”‚  âœ“ Google Sign-In                       â”‚
â”‚  âœ“ Email/Password (Admin)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Firestore Security Rules          â”‚
â”‚                                         â”‚
â”‚  âœ“ Users can update own fcmToken        â”‚
â”‚  âœ“ Users can read own notifications     â”‚
â”‚  âœ“ Users can mark own notifications readâ”‚
â”‚  âœ“ Admins can create notifications      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Cloud Function Security            â”‚
â”‚                                         â”‚
â”‚  âœ“ onCreate: Automatic (no auth needed)â”‚
â”‚  âœ“ Callable: Requires authentication    â”‚
â”‚  âœ“ Bulk send: Admin role check          â”‚
â”‚  âœ“ Scheduled: System (no auth needed)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         FCM Token Security              â”‚
â”‚                                         â”‚
â”‚  âœ“ Token is device-specific             â”‚
â”‚  âœ“ Token expires automatically          â”‚
â”‚  âœ“ Token refreshes automatically        â”‚
â”‚  âœ“ Can't be reused across devices       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ Scalability Considerations

### Current Implementation
- âœ… Handles individual notifications efficiently
- âœ… Background processing via Cloud Functions
- âœ… Automatic token refresh
- âœ… Scheduled cleanup of old tokens

### Future Scaling Options
- ğŸ”„ Use FCM topics for group notifications
- ğŸ”„ Implement notification batching
- ğŸ”„ Add message queuing for large volumes
- ğŸ”„ Cache frequently accessed tokens
- ğŸ”„ Implement rate limiting

## ğŸ¨ UI/UX Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         User's Experience            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 1: App is Open (Foreground)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User browsing events                â”‚
â”‚         â”‚                           â”‚
â”‚         â”‚ Push notification arrives â”‚
â”‚         â–¼                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  In-App Notification Banner     â”‚ â”‚
â”‚ â”‚  "Registration Cancelled"       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                           â”‚
â”‚         â”‚ Tap notification          â”‚
â”‚         â–¼                           â”‚
â”‚ Navigate to Notifications Screen    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 2: App in Background
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User using another app              â”‚
â”‚         â”‚                           â”‚
â”‚         â”‚ Push notification arrives â”‚
â”‚         â–¼                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  System Notification Tray       â”‚ â”‚
â”‚ â”‚  ğŸ”” DIU Events                  â”‚ â”‚
â”‚ â”‚  Registration Cancelled          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                           â”‚
â”‚         â”‚ Tap notification          â”‚
â”‚         â–¼                           â”‚
â”‚ App opens â†’ Notifications Screen    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 3: App Closed/Terminated
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App not running                     â”‚
â”‚         â”‚                           â”‚
â”‚         â”‚ Push notification arrives â”‚
â”‚         â–¼                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  System Notification            â”‚ â”‚
â”‚ â”‚  ğŸ”” DIU Events                  â”‚ â”‚
â”‚ â”‚  Registration Cancelled          â”‚ â”‚
â”‚ â”‚  Tap to open                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                           â”‚
â”‚         â”‚ Tap notification          â”‚
â”‚         â–¼                           â”‚
â”‚ App launches â†’ Notifications Screen â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Legend:**
- `â”‚` : Flow direction
- `â”œâ”€â–º` : Process step
- `â””â”€â–º` : Final step
- `â–¼` : Continues to next component
- `âœ…` : Implemented
- `ğŸ”„` : Future enhancement
- `ğŸ””` : Notification
- `ğŸ“±` : User's device
